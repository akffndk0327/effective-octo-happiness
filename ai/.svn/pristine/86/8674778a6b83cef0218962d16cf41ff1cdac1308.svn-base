package kr.or.ddit.mypage.controller;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.inject.Inject;

import org.springframework.http.MediaType;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import kr.or.ddit.mypage.service.IAdminMypageService;
import kr.or.ddit.mypage.service.IMemMypageService;
import kr.or.ddit.vo.MemberVO;
import kr.or.ddit.vo.PagingInfoVO;

@Controller
@RequestMapping("/adminMypage")
public class AdminRetireveMemberController {
	
	@Inject
	IAdminMypageService service;
	
	@Inject
	IMemMypageService memMypageService;
	
	@RequestMapping("memberList.do")
	public String memberList(
			@RequestParam(required=false) String searchType,
			@RequestParam(required=false) String searchWord,
			@RequestParam(name="page", required=false, defaultValue="1") int currentPage
			, Model model
			) {
		Map<String, Object> searchMap = new HashMap<>();
		searchMap.put("searchType", searchType);
		searchMap.put("searchWord", searchWord);
		
		PagingInfoVO<MemberVO> pagingVO = new PagingInfoVO<MemberVO>(10, 5);
		pagingVO.setSearchMap(searchMap);
		int totalRecord = service.retrieveMemberCount(pagingVO);
		pagingVO.setTotalRecord(totalRecord);
		pagingVO.setCurrentPage(currentPage);
		List<MemberVO> list = service.retrieveMemberList(pagingVO);
		pagingVO.setDataList(list);
		
		model.addAttribute("pagingVO", pagingVO);
		
		String viewName= "adminMypage/memberList";
		
		return viewName;
	}
	
	
	@SuppressWarnings("unchecked")
	@RequestMapping(value="memberList.do", produces=MediaType.APPLICATION_JSON_UTF8_VALUE)
	@ResponseBody
	public PagingInfoVO<MemberVO> memberListAjax(
			@RequestParam(required=false) String searchType,
			@RequestParam(required=false) String searchWord,
			@RequestParam(name="page", required=false, defaultValue="1") int currentPage
			, Model model
			){
		memberList(searchType, searchWord, currentPage, model);
		return (PagingInfoVO<MemberVO>) model.asMap().get("pagingVO"); 
	}
	
	
	@RequestMapping("memberView.do")
	public String memberView(
			@RequestParam(required=true) String who, Model model){
		
		MemberVO saved = service.retrieveMember(new MemberVO(who, null));
		model.addAttribute("member", saved);
		String viewName = "/adminMypage/memberView";
		return viewName;
	}
	
	
	@RequestMapping("memDelete.do")
	public String memDelete(
			@RequestParam(required=true) String memId,
			Model model
			) {
		
		memMypageService.removeMember(memId);
		String viewName=null;
		return viewName;
	}
	
	
}
